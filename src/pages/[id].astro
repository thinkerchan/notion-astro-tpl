---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';
import Tag from '../components/tag.astro';
import { getApps } from '../utils/notion';
import { marked } from 'marked';
import { SITE } from '../config';
export async function getStaticPaths() {
  const apps = await getApps();
  return apps.map(app => ({
    params: { id: app.id },
    props: { app },
  }));
}

const { app } = Astro.props;
const htmlContent = marked(app.content);
---

<Layout title={`${app.title} | ${SITE.author}`}>
  <main class="max-w-5xl  mx-auto px-4 lg:px-12  py-12">
    <div class="mx-auto bg-white rounded-lg shadow-md p-6 relative">
      <div class="absolute left-4 top-4 text-gray-600 hover:text-gray-900">
        <a href="/">
          <svg t="1733825105812" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1462" width="28" height="28"><path d="M622.651 263.568h-174.906v-142.078l-383.764 191.881 383.763 191.882 0-141.752h189.391c149.914 0 224.855 62.789 224.855 188.368 0 129.928-77.436 194.876-232.339 194.876h-441.7v99.932h446.194c211.185 0 316.778-95.104 316.778-285.311-0-198.521-109.414-297.798-328.274-297.798z" p-id="1463" fill="#8a8a8a"></path></svg>
        </a>
      </div>

      <div class="flex flex-col md:flex-row items-center md:items-start gap-6 p-4">
        <img
          src={app.icon || '/images/avatar.png'}
          class="w-40 h-40 rounded-lg  object-cover mt-1"
          alt={app.title}
        />

        <div class="flex-1 w-full md:pl-2">
          <h1 class="text-5xl font-bold text-center md:text-left mb-4 bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">
            {app.title}
          </h1>

          <div class="space-y-3 text-gray-600">

            <div class="flex flex-wrap gap-3 ">
              {app.tags.map((tag) => (<Tag tag={tag} />))}
            </div>

            <p class="flex">
              <span class="mr-6">🗓️ {app.date}</span>
              {app.link && (
                <>
                  <a
                    href={app.link}
                    class="text-primary-500 hover:text-primary-600 transition-colors break-all flex items-center gap-1 text-blue-400"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    🔗 点此访问
                  </a>
                </>
              )}
            </p>

            <p>
              💡 {app.desc}
            </p>

          </div>
        </div>
      </div>

      <hr class="mb-6">

      <div class="mb-6">
         <div class="markdown-body" set:html={htmlContent}></div>
      </div>

      <div id="Jcomment"></div>
    </div>

    <div class="flex text-gray-400 text-sm align-middle justify-center mt-4" style={ SITE.pv?'':'display:none;'}>
        <span id="busuanzi_container_site_pv">
          @{SITE.author} PV
          <span id="busuanzi_value_site_pv"></span>
        </span>
    </div>

  </main>
  <Footer />
</Layout>